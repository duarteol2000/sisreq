{% extends "core/base.html" %}
{% load static %}

{% block title %}Recibo{% endblock %}

{% block content %}
<style>
  @media print {
    .no-print,
    nav { display: none !important; }
  }
  .logo-recibo {
    max-height: 80px;
    max-width: 220px;
  }
  .signature-block {
    margin-top: 32px;
  }
  .signature-line {
    border-bottom: 1px solid #000;
    height: 40px;
    margin-bottom: 6px;
  }
</style>
<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-3 no-print">
    <h2 class="mb-0">Recibo {{ recibo.numero_recibo }}</h2>
    <div class="d-flex gap-2">
      <a href="{% url 'estoque:listar_requisicoes' %}" class="btn btn-sm btn-outline-secondary">
        Voltar para minhas requisições
      </a>
      <button type="button" class="btn btn-sm btn-primary" onclick="window.print();">
        Imprimir
      </button>
    </div>
  </div>
  <div class="text-center mb-3">
    {% if recibo.secretaria.logo %}
      <img src="{{ recibo.secretaria.logo.url }}" alt="{{ recibo.secretaria }}" class="logo-recibo">
    {% elif recibo.prefeitura.logo %}
      <img src="{{ recibo.prefeitura.logo.url }}" alt="{{ recibo.prefeitura }}" class="logo-recibo">
    {% endif %}
  </div>
  <p><strong>Prefeitura:</strong> {{ recibo.prefeitura }}</p>
  <p><strong>Secretaria:</strong> {{ recibo.secretaria }}</p>
  <p><strong>Emitido por:</strong> {{ recibo.emitido_por.nome_completo }}</p>
  <p><strong>Data de emissão:</strong> {{ recibo.data_emissao|date:"d/m/Y H:i" }}</p>

  <p><strong>Nº Requisição:</strong> {{ recibo.requisicao.numero_requisicao }}</p>
  <p><strong>Observação do administrador:</strong> {{ recibo.requisicao.observacao_administrador|default:"-" }}</p>

  <h4 class="mt-4">Itens da Requisição</h4>
  <table class="table table-striped mt-2">
    <thead>
      <tr>
        <th>Material</th>
        <th class="text-right">Qtd. solicitada</th>
        <th class="text-right">Qtd. liberada</th>
        <th>Situação</th>
      </tr>
    </thead>
    <tbody>
      {% for item in itens %}
      <tr>
        <td>{{ item.material }}</td>
        <td class="text-right">{{ item.quantidade_solicitada }}</td>
        <td class="text-right">{{ item.quantidade_liberada }}</td>
        <td>
          {% if item.quantidade_liberada == 0 %}
            Não atendido
          {% elif item.quantidade_liberada < item.quantidade_solicitada %}
            Parcialmente atendido
          {% else %}
            Atendido
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <div class="row signature-block">
    <div class="col-md-6 text-center">
      <div class="signature-line"></div>
      <div class="small text-secondary">Responsável pela entrega (Administrador)</div>
      <div class="small">{{ recibo.emitido_por.nome_completo }}</div>
    </div>
    <div class="col-md-6 text-center">
      <div class="signature-line"></div>
      <div class="small text-secondary">Recebido por (Solicitante)</div>
      <div class="small">{{ recibo.requisicao.solicitante.nome_completo }}</div>
    </div>
  </div>
</div>
{% endblock %}
